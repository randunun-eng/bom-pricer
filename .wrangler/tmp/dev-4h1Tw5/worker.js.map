{
  "version": 3,
  "sources": ["../bundle-8vPeRA/checked-fetch.js", "../../../api/worker.js", "../../../../.nvm/versions/node/v20.19.5/lib/node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts", "../../../../.nvm/versions/node/v20.19.5/lib/node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts", "../bundle-8vPeRA/middleware-insertion-facade.js", "../../../../.nvm/versions/node/v20.19.5/lib/node_modules/wrangler/templates/middleware/common.ts", "../bundle-8vPeRA/middleware-loader.entry.ts"],
  "sourceRoot": "/home/dell/bom-pricer/.wrangler/tmp/dev-4h1Tw5",
  "sourcesContent": ["const urls = new Set();\n\nfunction checkURL(request, init) {\n\tconst url =\n\t\trequest instanceof URL\n\t\t\t? request\n\t\t\t: new URL(\n\t\t\t\t\t(typeof request === \"string\"\n\t\t\t\t\t\t? new Request(request, init)\n\t\t\t\t\t\t: request\n\t\t\t\t\t).url\n\t\t\t\t);\n\tif (url.port && url.port !== \"443\" && url.protocol === \"https:\") {\n\t\tif (!urls.has(url.toString())) {\n\t\t\turls.add(url.toString());\n\t\t\tconsole.warn(\n\t\t\t\t`WARNING: known issue with \\`fetch()\\` requests to custom HTTPS ports in published Workers:\\n` +\n\t\t\t\t\t` - ${url.toString()} - the custom port will be ignored when the Worker is published using the \\`wrangler deploy\\` command.\\n`\n\t\t\t);\n\t\t}\n\t}\n}\n\nglobalThis.fetch = new Proxy(globalThis.fetch, {\n\tapply(target, thisArg, argArray) {\n\t\tconst [request, init] = argArray;\n\t\tcheckURL(request, init);\n\t\treturn Reflect.apply(target, thisArg, argArray);\n\t},\n});\n", "// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n// BOM Pricer - Cloudflare Worker\n// Full Pipeline: Parse \u2192 Query D1 \u2192 Nova \u2192 Currency \u2192 Response\n// \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n// --- Currency Conversion ---\nconst FX_RATES = {\n  LKR: 1 / 320.0,\n  USD: 1.0\n};\n\nfunction toUsd(value, currency) {\n  const rate = FX_RATES[currency];\n  if (rate == null) return null;\n  return Math.round(value * rate * 10000) / 10000;\n}\n\n// --- Pack Quantity Extraction ---\n// Extracts pack quantity from variant labels like \"4Pcs LITTLEBEE 30A\" \u2192 4\nfunction extractPackQty(label) {\n  if (!label) return 1;\n  const match = label.match(/(\\d+)\\s*(pcs|pc)/i);\n  return match ? parseInt(match[1], 10) : 1;\n}\n\n// Strips quantity words from label to avoid duplication like \"4Pcs 1Pc LITTLEBEE\"\nfunction stripQtyWords(label) {\n  if (!label) return \"\";\n  return label\n    .replace(/\\b\\d+\\s*(pcs|pc)\\b/ig, \"\")  // remove \"1Pc\", \"4Pcs\", etc\n    .replace(/\\s{2,}/g, \" \")              // normalize multiple spaces\n    .trim();\n}\n\n// --- BOM Parser (Deterministic) ---\nfunction parseBomLine(line) {\n  const upper = line.trim().toUpperCase();\n  let qty = 1;\n\n  const qtyMatch = upper.match(/X\\s*(\\d+)/);\n  if (qtyMatch) qty = parseInt(qtyMatch[1], 10);\n\n  const ampMatch = upper.match(/(\\d+)\\s*A/);\n  const currentA = ampMatch ? parseInt(ampMatch[1], 10) : null;\n\n  const isEsc = upper.includes(\"ESC\");\n\n  return {\n    canonical_type: isEsc ? \"ESC\" : null,\n    current_A: currentA,\n    qty,\n    raw: upper\n  };\n}\n\nfunction parseBom(text) {\n  return text\n    .trim()\n    .split(\"\\n\")\n    .map((l) => l.trim())\n    .filter((l) => l.length > 0)\n    .map(parseBomLine);\n}\n\n// --- Nova ACT Stub (Mock for now) ---\n// Replace with real HTTP call when Nova is ready\nfunction novaRank(bomItem, candidates) {\n  // Mock logic: pick first candidate (cheapest should be sorted or just index 0)\n  if (!candidates || candidates.length === 0) {\n    return { selected_index: -1, match_score: 0, reasoning: \"No candidates\" };\n  }\n  return {\n    selected_index: 0,\n    match_score: 0.85,\n    reasoning: \"Exact match in variant label and lowest price (mock).\"\n  };\n}\n\n// --- CSV Formatter ---\nfunction toCSV(items) {\n  const header = [\n    \"Description\",\n    \"Quantity\",\n    \"Unit Price (USD)\",\n    \"Total Price (USD)\",\n    \"Supplier\",\n    \"Confidence\",\n    \"Reasoning\",\n    \"Product URL\"\n  ];\n\n  const rows = items.map(i => {\n    if (i.status !== \"MATCHED\") {\n      return [\n        i.bom?.raw || \"Unknown\",\n        i.bom?.qty || 1,\n        \"\",\n        \"\",\n        \"\",\n        \"\",\n        i.status,\n        \"\"\n      ];\n    }\n    return [\n      `${i.bom.current_A}A ESC`,\n      i.bom.qty,\n      i.unit_price_usd,\n      i.total_price_usd,\n      i.selected?.seller?.name || \"Unknown\",\n      i.match_score,\n      i.reasoning,\n      i.selected?.product_url || \"\"\n    ];\n  });\n\n  // UTF-8 BOM for LibreOffice Calc compatibility\n  const BOM = \"\\uFEFF\";\n  return BOM + [header, ...rows]\n    .map(r => r.map(v => `\"${String(v ?? \"\").replace(/\"/g, '\"\"')}\"`).join(\",\"))\n    .join(\"\\r\\n\");\n}\n\n// --- Confidence Decay (based on price age) ---\nfunction calculateConfidenceDecay(baseScore, lastUpdated) {\n  if (!lastUpdated) return baseScore;\n  const now = new Date();\n  const updated = new Date(lastUpdated);\n  const daysOld = (now - updated) / (1000 * 60 * 60 * 24);\n  // Decay: confidence *= exp(-daysOld / 30)\n  const decayFactor = Math.exp(-daysOld / 30);\n  return Math.round(baseScore * decayFactor * 100) / 100;\n}\n\n// --- Main Handler ---\nexport default {\n  // Scheduled handler for cron triggers\n  async scheduled(event, env, ctx) {\n    // This would trigger the refresh pipeline\n    // In production: call Anti-Gravity crawler, normalize, upsert to DB\n    console.log(\"Scheduled refresh triggered at:\", new Date().toISOString());\n    // TODO: Implement actual refresh logic\n    return;\n  },\n\n  async fetch(req, env) {\n    const url = new URL(req.url);\n\n    // Admin refresh endpoint (protected)\n    if (url.pathname === \"/admin/refresh\") {\n      const adminKey = req.headers.get(\"X-ADMIN-KEY\");\n      if (!adminKey || adminKey !== env.ADMIN_KEY) {\n        return new Response(\"Unauthorized\", { status: 401 });\n      }\n      // Trigger refresh logic (placeholder for now)\n      return Response.json({\n        status: \"refresh_triggered\",\n        timestamp: new Date().toISOString(),\n        message: \"Crawl job queued. Anti-Gravity will update prices.\"\n      });\n    }\n\n    // CORS preflight\n    if (req.method === \"OPTIONS\") {\n      return new Response(null, {\n        headers: {\n          \"Access-Control-Allow-Origin\": \"*\",\n          \"Access-Control-Allow-Methods\": \"POST, OPTIONS\",\n          \"Access-Control-Allow-Headers\": \"Content-Type\"\n        }\n      });\n    }\n\n    // Serve UI on GET\n    if (req.method === \"GET\") {\n      const html = `<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>BOM Pricer</title>\n  <style>\n    * { box-sizing: border-box; }\n    body {\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      max-width: 900px;\n      margin: 40px auto;\n      padding: 20px;\n      background: #0f0f0f;\n      color: #e0e0e0;\n    }\n    h1 {\n      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n      -webkit-background-clip: text;\n      -webkit-text-fill-color: transparent;\n      font-size: 2.5rem;\n      margin-bottom: 8px;\n    }\n    .subtitle { color: #888; margin-bottom: 30px; }\n    textarea {\n      width: 100%;\n      padding: 16px;\n      border: 1px solid #333;\n      border-radius: 12px;\n      background: #1a1a1a;\n      color: #fff;\n      font-family: 'Monaco', 'Consolas', monospace;\n      font-size: 14px;\n      resize: vertical;\n    }\n    textarea:focus { outline: none; border-color: #667eea; }\n    .btn-group { margin: 20px 0; display: flex; gap: 12px; }\n    button {\n      padding: 12px 28px;\n      border: none;\n      border-radius: 8px;\n      font-size: 16px;\n      font-weight: 600;\n      cursor: pointer;\n      transition: transform 0.1s, box-shadow 0.2s;\n    }\n    button:hover { transform: translateY(-2px); }\n    button:active { transform: translateY(0); }\n    .btn-primary {\n      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n      color: white;\n    }\n    .btn-secondary {\n      background: #2a2a2a;\n      color: #e0e0e0;\n      border: 1px solid #444;\n    }\n    table {\n      width: 100%;\n      border-collapse: collapse;\n      margin-top: 20px;\n      background: #1a1a1a;\n      border-radius: 12px;\n      overflow: hidden;\n    }\n    th, td {\n      padding: 14px 16px;\n      text-align: left;\n      border-bottom: 1px solid #2a2a2a;\n    }\n    th {\n      background: #252525;\n      color: #888;\n      font-weight: 500;\n      text-transform: uppercase;\n      font-size: 12px;\n    }\n    tr:hover td { background: #222; }\n    .price { color: #fbbf24; font-weight: 600; }\n    .confidence { color: #60a5fa; }\n    a { color: #818cf8; text-decoration: none; }\n    .status-error { color: #f87171; }\n    #loading { display: none; color: #888; padding: 20px; }\n    .spinner {\n      display: inline-block; width: 20px; height: 20px;\n      border: 2px solid #444; border-top-color: #667eea;\n      border-radius: 50%; animation: spin 0.8s linear infinite;\n      margin-right: 10px;\n    }\n    @keyframes spin { to { transform: rotate(360deg); } }\n    .total-row td { background: #252525; font-weight: 600; border-top: 2px solid #444; }\n    .badge { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; margin-left: 6px; }\n    .badge-low { background: #065f46; color: #34d399; }\n    .badge-medium { background: #78350f; color: #fbbf24; }\n    .badge-high { background: #7f1d1d; color: #f87171; }\n    .verified { color: #4ade80; font-size: 12px; display: block; margin-top: 4px; }\n    .verified::before { content: \"\u2713 \"; }\n    .warning { color: #fbbf24; font-size: 12px; display: block; margin-top: 4px; }\n    .warning::before { content: \"\u26A0 \"; }\n    .item-details { font-size: 11px; color: #888; margin-top: 4px; }\n    .candidates { margin: 8px 0; }\n    .candidate-row { padding: 6px 8px; margin: 4px 0; background: #1a1a1a; border-radius: 6px; border: 1px solid #333; transition: all 0.2s; }\n    .candidate-row:hover { border-color: #667eea; }\n    .candidate-row label { display: flex; align-items: center; gap: 8px; cursor: pointer; font-size: 13px; }\n    .candidate-row input[type=radio] { accent-color: #667eea; }\n    .candidate-row .brand { color: #60a5fa; font-weight: 600; }\n    .candidate-row .price { color: #fbbf24; margin-left: auto; }\n    .candidate-row .remark { color: #888; font-size: 11px; }\n    .candidate-row .pack-info { color: #6b7280; font-size: 10px; margin-left: 4px; }\n    .risk-badge { padding: 1px 6px; border-radius: 3px; font-size: 10px; font-weight: 600; margin-left: 8px; }\n    .risk-low { background: #065f46; color: #34d399; }\n    .risk-medium { background: #78350f; color: #fbbf24; }\n    .risk-high { background: #7f1d1d; color: #f87171; }\n    .row-unit, .row-total { transition: all 0.3s; }\n  </style>\n</head>\n<body>\n  <h1>BOM Pricer</h1>\n  <p class=\"subtitle\">Paste your Bill of Materials, get instant pricing from AliExpress</p>\n  <textarea id=\"bom\" rows=\"6\">30A ESC x2\n40A ESC x1</textarea>\n  <div class=\"btn-group\">\n    <button class=\"btn-primary\" id=\"btn-price\">Get Prices</button>\n    <button class=\"btn-secondary\" id=\"btn-csv\">Download CSV</button>\n  </div>\n  <div id=\"loading\"><span class=\"spinner\"></span>Fetching prices...</div>\n  <div id=\"results\"></div>\n  <script>\n    // Make functions globally accessible\n    window.price = async function() {\n      const bom = document.getElementById(\"bom\").value;\n      document.getElementById(\"loading\").style.display = \"block\";\n      document.getElementById(\"results\").innerHTML = \"\";\n      try {\n        const res = await fetch(\"/\", { method: \"POST\", headers: {\"Content-Type\": \"application/json\"}, body: JSON.stringify({ bom }) });\n        const data = await res.json();\n        console.log(\"API Response received:\", data.status, \"Items:\", data.items?.length);\n        renderTable(data);\n      } catch (e) {\n        console.error(\"Fetch error:\", e);\n        document.getElementById(\"results\").innerHTML = '<p class=\"status-error\">Error: ' + e.message + '</p>';\n      } finally {\n        document.getElementById(\"loading\").style.display = \"none\";\n      }\n    };\n    let bomData = null;\n    function renderTable(data) {\n      bomData = data;\n      if (!data.items?.length) { document.getElementById(\"results\").innerHTML = \"<p>No results.</p>\"; return; }\n      let html = '<table><thead><tr><th>Item</th><th>Qty</th><th>Select Supplier</th><th>Unit Price</th><th>Total</th></tr></thead><tbody>';\n      for (const i of data.items) {\n        if (i.status === \"MATCHED\") {\n          const itemKey = i.bom.current_A + 'A_ESC';\n          const defaultCand = i.candidates?.find(c => c.default) || i.candidates?.[0];\n          html += '<tr>';\n          html += '<td>' + i.bom.current_A + 'A ESC<span class=\"verified\">Variant verified</span></td>';\n          html += '<td class=\"qty\" data-item=\"' + itemKey + '\">' + i.bom.qty + '</td>';\n          html += '<td><div class=\"candidates\" data-item=\"' + itemKey + '\" data-qty=\"' + i.bom.qty + '\">';\n          if (i.candidates) {\n            for (const c of i.candidates) {\n              html += '<div class=\"candidate-row\">';\n              html += '<label>';\n              html += '<input type=\"radio\" name=\"cand_' + itemKey + '\" value=\"' + c.id + '\" ' + (c.default ? 'checked' : '') + ' data-price-usd=\"' + c.unit_price_usd + '\" data-price-local=\"' + c.unit_price_local + '\" data-currency=\"' + c.local_currency + '\" data-pack-qty=\"' + (c.pack_qty || 1) + '\" data-pack-price-usd=\"' + (c.pack_price_usd || c.unit_price_usd) + '\" data-item-key=\"' + itemKey + '\" data-qty=\"' + i.bom.qty + '\">';\n              html += '<span class=\"brand\">' + c.brand + '</span> ' + c.model;\n              html += '<span class=\"risk-badge risk-' + c.risk.toLowerCase() + '\">' + c.risk + '</span>';\n              // Show unit price with pack breakdown if pack_qty > 1\n              if (c.pack_qty > 1) {\n                html += '<span class=\"price\">$' + (c.unit_price_usd?.toFixed(2) || '-') + '/unit</span>';\n                html += '<span class=\"pack-info\">(' + c.pack_qty + 'pcs = $' + (c.pack_price_usd?.toFixed(2) || '-') + ')</span>';\n              } else {\n                html += '<span class=\"price\">$' + (c.unit_price_usd?.toFixed(2) || '-') + '</span>';\n              }\n              html += '</label>';\n              html += '<span class=\"remark\">' + c.remark + '</span>';\n              html += '</div>';\n            }\n          }\n          html += '</div></td>';\n          html += '<td class=\"price row-unit\" data-item=\"' + itemKey + '\">$' + (defaultCand?.unit_price_usd?.toFixed(2) || i.unit_price_usd?.toFixed(2) || '-') + ' USD';\n          if (defaultCand?.local_currency && defaultCand.local_currency !== 'USD') {\n            html += '<span class=\"item-details\">\u2248 ' + defaultCand.local_currency + ' ' + Math.round(defaultCand.unit_price_local) + '</span>';\n          }\n          html += '</td>';\n          html += '<td class=\"price row-total\" data-item=\"' + itemKey + '\">$' + ((defaultCand?.unit_price_usd || i.unit_price_usd) * i.bom.qty).toFixed(2) + '</td>';\n          html += '</tr>';\n        } else {\n          html += '<tr><td>' + (i.bom?.raw || 'Unknown') + '</td><td>' + (i.bom?.qty || '-') + '</td><td colspan=\"3\" class=\"status-error\">' + i.status + '</td></tr>';\n        }\n      }\n      html += '<tr class=\"total-row\"><td colspan=\"3\">Total BOM Cost</td><td></td><td class=\"price\" id=\"bom-total\">$' + recalcBomTotal() + '</td></tr></tbody></table>';\n      document.getElementById(\"results\").innerHTML = html;\n      recalcBomTotal();\n    }\n    window.onCandidateSelected = function(itemKey, qty) {\n      const selected = document.querySelector('input[name=\"cand_' + itemKey + '\"]:checked');\n      if (!selected) return;\n      const unitUsd = parseFloat(selected.dataset.priceUsd);\n      const unitLocal = parseFloat(selected.dataset.priceLocal);\n      const currency = selected.dataset.currency;\n      const rowUnit = document.querySelector('.row-unit[data-item=\"' + itemKey + '\"]');\n      const rowTotal = document.querySelector('.row-total[data-item=\"' + itemKey + '\"]');\n      if (rowUnit) rowUnit.innerHTML = '$' + unitUsd.toFixed(2) + ' USD' + (currency !== 'USD' ? '<span class=\"item-details\">\u2248 ' + currency + ' ' + Math.round(unitLocal) + '</span>' : '');\n      if (rowTotal) rowTotal.innerText = '$' + (unitUsd * qty).toFixed(2);\n      recalcBomTotal();\n    };\n    function recalcBomTotal() {\n      let total = 0;\n      document.querySelectorAll('.candidates').forEach(c => {\n        const itemKey = c.dataset.item;\n        const qty = parseInt(c.dataset.qty) || 1;\n        const selected = document.querySelector('input[name=\"cand_' + itemKey + '\"]:checked');\n        if (selected) total += parseFloat(selected.dataset.priceUsd) * qty;\n      });\n      const bomTotalEl = document.getElementById('bom-total');\n      if (bomTotalEl) bomTotalEl.innerText = '$' + total.toFixed(2);\n      return total.toFixed(2);\n    }\n    window.downloadCSV = async function() {\n      const bom = document.getElementById(\"bom\").value;\n      if (!bom.trim()) { alert(\"Please enter a BOM first\"); return; }\n      try {\n        const res = await fetch(\"/?format=csv\", { method: \"POST\", headers: {\"Content-Type\": \"application/json\"}, body: JSON.stringify({ bom }) });\n        if (!res.ok) { alert(\"Error fetching CSV\"); return; }\n        const blob = await res.blob();\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement(\"a\");\n        a.href = url;\n        a.download = \"bom_pricing_\" + new Date().toISOString().slice(0,10) + \".csv\";\n        document.body.appendChild(a);\n        a.click();\n        document.body.removeChild(a);\n        URL.revokeObjectURL(url);\n      } catch (e) { alert(\"Download failed: \" + e.message); }\n    };\n    \n    // Attach event listeners (DOM already loaded since script is at end of body)\n    document.getElementById('btn-price').addEventListener('click', window.price);\n    document.getElementById('btn-csv').addEventListener('click', window.downloadCSV);\n    \n    // Event delegation for candidate radio buttons (dynamically added)\n    document.getElementById('results').addEventListener('change', function(e) {\n      if (e.target.type === 'radio' && e.target.dataset.itemKey) {\n        const itemKey = e.target.dataset.itemKey;\n        const qty = parseInt(e.target.dataset.qty) || 1;\n        window.onCandidateSelected(itemKey, qty);\n      }\n    });\n  </script>\n</body>\n</html>`;\n      return new Response(html, { headers: { \"Content-Type\": \"text/html\", \"Access-Control-Allow-Origin\": \"*\" } });\n    }\n\n    if (req.method !== \"POST\") {\n      return new Response(\"POST only\", { status: 405 });\n    }\n\n    let body;\n    try {\n      body = await req.json();\n    } catch {\n      return Response.json({ status: \"error\", message: \"Invalid JSON\" }, { status: 400 });\n    }\n\n    const bomText = body.bom;\n    if (!bomText || typeof bomText !== \"string\") {\n      return Response.json({ status: \"error\", message: \"Missing 'bom' field\" }, { status: 400 });\n    }\n\n    // 1. Parse BOM\n    const bomItems = parseBom(bomText);\n\n    // 2. Process each BOM line\n    const results = [];\n    for (const b of bomItems) {\n      if (!b.canonical_type || b.current_A == null) {\n        results.push({ bom: b, status: \"INVALID_LINE\" });\n        continue;\n      }\n\n      // 3. Query D1 Catalog\n      const { results: rows } = await env.DB.prepare(`\n        SELECT title, variant, current_A, price_value, price_currency,\n               seller_name, seller_rating, product_url, last_updated\n        FROM catalog_items\n        WHERE canonical_type = ? AND current_A = ?\n      `)\n        .bind(b.canonical_type, b.current_A)\n        .all();\n\n      const candidates = rows.map((r) => ({\n        title: r.title,\n        variant: r.variant,\n        current_A: r.current_A,\n        price_value: r.price_value,\n        price_currency: r.price_currency,\n        seller: { name: r.seller_name, rating: r.seller_rating },\n        product_url: r.product_url,\n        last_updated: r.last_updated\n      }));\n\n      if (candidates.length === 0) {\n        results.push({ bom: b, status: \"NOT_FOUND\" });\n        continue;\n      }\n\n      // 4. Build candidates array with brand/model parsing and pack normalization\n      const allCandidates = candidates.map((c, idx) => {\n        const brandMatch = c.title.match(/^(\\w+)/);\n        const brand = brandMatch ? brandMatch[1] : \"Unknown\";\n\n        // Extract pack quantity from variant label (e.g., \"4Pcs LITTLEBEE 30A\" \u2192 4)\n        const packQty = extractPackQty(c.variant);\n\n        // Clean display label: strip quantity words and rebuild with correct pack_qty\n        const cleanName = stripQtyWords(c.variant) || c.title.substring(0, 30);\n        const model = packQty > 1 ? `${packQty}Pcs ${cleanName}` : `1Pc ${cleanName}`;\n        const packPriceUsd = toUsd(c.price_value, c.price_currency);\n        const packPriceLocal = c.price_value;\n\n        // Normalize to unit price (pack price / pack quantity)\n        const unitPriceUsd = packPriceUsd != null ? Math.round((packPriceUsd / packQty) * 10000) / 10000 : null;\n        const unitPriceLocal = packPriceLocal / packQty;\n\n        const conf = calculateConfidenceDecay(0.85, c.last_updated);\n        const risk = conf >= 0.8 ? \"LOW\" : conf >= 0.5 ? \"MEDIUM\" : \"HIGH\";\n\n        return {\n          id: `cand_${idx}_${c.current_A}a`,\n          brand,\n          // Labels: raw for debugging, display for UI/CSV\n          raw_variant_label: c.variant,\n          display_label: model,\n          model,  // Keep for backward compatibility\n          title: c.title,\n          variant: c.variant,\n          // Pack pricing (original)\n          pack_qty: packQty,\n          pack_price_usd: packPriceUsd,\n          pack_price_local: packPriceLocal,\n          // Normalized unit pricing\n          unit_price_usd: unitPriceUsd,\n          unit_price_local: unitPriceLocal,\n          local_currency: c.price_currency,\n          confidence: conf,\n          risk,\n          remark: c.seller?.name || \"AliExpress Seller\",\n          variant_verified: true,\n          stock_ok: true,\n          product_url: c.product_url,\n          last_updated: c.last_updated,\n          default: false\n        };\n      });\n\n      // Sort by confidence desc, then price asc\n      allCandidates.sort((a, b) => {\n        if (b.confidence !== a.confidence) return b.confidence - a.confidence;\n        return (a.unit_price_usd || 999) - (b.unit_price_usd || 999);\n      });\n\n      // Mark first as default\n      if (allCandidates.length > 0) {\n        allCandidates[0].default = true;\n      }\n\n      // 5. Nova ACT Ranking (for backward compatibility)\n      const nova = novaRank(b, candidates);\n      const selectedIdx = nova.selected_index >= 0 ? nova.selected_index : 0;\n      const selected = candidates[selectedIdx];\n\n      // 6. Currency Conversion\n      const unitPriceUsd = toUsd(selected.price_value, selected.price_currency);\n      const totalPriceUsd = unitPriceUsd != null ? unitPriceUsd * b.qty : null;\n\n      // 7. Apply confidence decay based on price age\n      const decayedScore = calculateConfidenceDecay(nova.match_score, selected.last_updated);\n\n      results.push({\n        bom: b,\n        status: \"MATCHED\",\n        selected,\n        unit_price_usd: unitPriceUsd,\n        total_price_usd: totalPriceUsd,\n        unit_price_local: selected.price_value,\n        local_currency: selected.price_currency,\n        fx_rate_used: FX_RATES[selected.price_currency] || null,\n        match_score: decayedScore,\n        reasoning: nova.reasoning,\n        price_age: selected.last_updated,\n        // NEW: candidates array\n        candidates: allCandidates\n      });\n    }\n\n    // 7. Return Response (JSON or CSV)\n    const format = url.searchParams.get(\"format\");\n\n    if (format === \"csv\") {\n      const csv = toCSV(results);\n      return new Response(csv, {\n        headers: {\n          \"Content-Type\": \"text/csv\",\n          \"Content-Disposition\": \"attachment; filename=bom.csv\",\n          \"Access-Control-Allow-Origin\": \"*\"\n        }\n      });\n    }\n\n    return Response.json(\n      {\n        status: \"ok\",\n        currency: \"USD\",\n        generated_at: new Date().toISOString(),\n        items: results\n      },\n      {\n        headers: {\n          \"Access-Control-Allow-Origin\": \"*\"\n        }\n      }\n    );\n  }\n};\n", "import type { Middleware } from \"./common\";\n\nconst drainBody: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} finally {\n\t\ttry {\n\t\t\tif (request.body !== null && !request.bodyUsed) {\n\t\t\t\tconst reader = request.body.getReader();\n\t\t\t\twhile (!(await reader.read()).done) {}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error(\"Failed to drain the unused request body.\", e);\n\t\t}\n\t}\n};\n\nexport default drainBody;\n", "import type { Middleware } from \"./common\";\n\ninterface JsonError {\n\tmessage?: string;\n\tname?: string;\n\tstack?: string;\n\tcause?: JsonError;\n}\n\nfunction reduceError(e: any): JsonError {\n\treturn {\n\t\tname: e?.name,\n\t\tmessage: e?.message ?? String(e),\n\t\tstack: e?.stack,\n\t\tcause: e?.cause === undefined ? undefined : reduceError(e.cause),\n\t};\n}\n\n// See comment in `bundle.ts` for details on why this is needed\nconst jsonError: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} catch (e: any) {\n\t\tconst error = reduceError(e);\n\t\treturn Response.json(error, {\n\t\t\tstatus: 500,\n\t\t\theaders: { \"MF-Experimental-Error-Stack\": \"true\" },\n\t\t});\n\t}\n};\n\nexport default jsonError;\n", "\t\t\t\timport worker, * as OTHER_EXPORTS from \"/home/dell/bom-pricer/api/worker.js\";\n\t\t\t\timport * as __MIDDLEWARE_0__ from \"/home/dell/.nvm/versions/node/v20.19.5/lib/node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts\";\nimport * as __MIDDLEWARE_1__ from \"/home/dell/.nvm/versions/node/v20.19.5/lib/node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts\";\n\n\t\t\t\texport * from \"/home/dell/bom-pricer/api/worker.js\";\n\t\t\t\tconst MIDDLEWARE_TEST_INJECT = \"__INJECT_FOR_TESTING_WRANGLER_MIDDLEWARE__\";\n\t\t\t\texport const __INTERNAL_WRANGLER_MIDDLEWARE__ = [\n\t\t\t\t\t\n\t\t\t\t\t__MIDDLEWARE_0__.default,__MIDDLEWARE_1__.default\n\t\t\t\t]\n\t\t\t\texport default worker;", "export type Awaitable<T> = T | Promise<T>;\n// TODO: allow dispatching more events?\nexport type Dispatcher = (\n\ttype: \"scheduled\",\n\tinit: { cron?: string }\n) => Awaitable<void>;\n\nexport type IncomingRequest = Request<\n\tunknown,\n\tIncomingRequestCfProperties<unknown>\n>;\n\nexport interface MiddlewareContext {\n\tdispatch: Dispatcher;\n\tnext(request: IncomingRequest, env: any): Awaitable<Response>;\n}\n\nexport type Middleware = (\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tmiddlewareCtx: MiddlewareContext\n) => Awaitable<Response>;\n\nconst __facade_middleware__: Middleware[] = [];\n\n// The register functions allow for the insertion of one or many middleware,\n// We register internal middleware first in the stack, but have no way of controlling\n// the order that addMiddleware is run in service workers so need an internal function.\nexport function __facade_register__(...args: (Middleware | Middleware[])[]) {\n\t__facade_middleware__.push(...args.flat());\n}\nexport function __facade_registerInternal__(\n\t...args: (Middleware | Middleware[])[]\n) {\n\t__facade_middleware__.unshift(...args.flat());\n}\n\nfunction __facade_invokeChain__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tmiddlewareChain: Middleware[]\n): Awaitable<Response> {\n\tconst [head, ...tail] = middlewareChain;\n\tconst middlewareCtx: MiddlewareContext = {\n\t\tdispatch,\n\t\tnext(newRequest, newEnv) {\n\t\t\treturn __facade_invokeChain__(newRequest, newEnv, ctx, dispatch, tail);\n\t\t},\n\t};\n\treturn head(request, env, ctx, middlewareCtx);\n}\n\nexport function __facade_invoke__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tfinalMiddleware: Middleware\n): Awaitable<Response> {\n\treturn __facade_invokeChain__(request, env, ctx, dispatch, [\n\t\t...__facade_middleware__,\n\t\tfinalMiddleware,\n\t]);\n}\n", "// This loads all middlewares exposed on the middleware object and then starts\n// the invocation chain. The big idea is that we can add these to the middleware\n// export dynamically through wrangler, or we can potentially let users directly\n// add them as a sort of \"plugin\" system.\n\nimport ENTRY, { __INTERNAL_WRANGLER_MIDDLEWARE__ } from \"/home/dell/bom-pricer/.wrangler/tmp/bundle-8vPeRA/middleware-insertion-facade.js\";\nimport { __facade_invoke__, __facade_register__, Dispatcher } from \"/home/dell/.nvm/versions/node/v20.19.5/lib/node_modules/wrangler/templates/middleware/common.ts\";\nimport type { WorkerEntrypointConstructor } from \"/home/dell/bom-pricer/.wrangler/tmp/bundle-8vPeRA/middleware-insertion-facade.js\";\n\n// Preserve all the exports from the worker\nexport * from \"/home/dell/bom-pricer/.wrangler/tmp/bundle-8vPeRA/middleware-insertion-facade.js\";\n\nclass __Facade_ScheduledController__ implements ScheduledController {\n\treadonly #noRetry: ScheduledController[\"noRetry\"];\n\n\tconstructor(\n\t\treadonly scheduledTime: number,\n\t\treadonly cron: string,\n\t\tnoRetry: ScheduledController[\"noRetry\"]\n\t) {\n\t\tthis.#noRetry = noRetry;\n\t}\n\n\tnoRetry() {\n\t\tif (!(this instanceof __Facade_ScheduledController__)) {\n\t\t\tthrow new TypeError(\"Illegal invocation\");\n\t\t}\n\t\t// Need to call native method immediately in case uncaught error thrown\n\t\tthis.#noRetry();\n\t}\n}\n\nfunction wrapExportedHandler(worker: ExportedHandler): ExportedHandler {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn worker;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\tconst fetchDispatcher: ExportedHandlerFetchHandler = function (\n\t\trequest,\n\t\tenv,\n\t\tctx\n\t) {\n\t\tif (worker.fetch === undefined) {\n\t\t\tthrow new Error(\"Handler does not export a fetch() function.\");\n\t\t}\n\t\treturn worker.fetch(request, env, ctx);\n\t};\n\n\treturn {\n\t\t...worker,\n\t\tfetch(request, env, ctx) {\n\t\t\tconst dispatcher: Dispatcher = function (type, init) {\n\t\t\t\tif (type === \"scheduled\" && worker.scheduled !== undefined) {\n\t\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\t\tDate.now(),\n\t\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t\t() => {}\n\t\t\t\t\t);\n\t\t\t\t\treturn worker.scheduled(controller, env, ctx);\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn __facade_invoke__(request, env, ctx, dispatcher, fetchDispatcher);\n\t\t},\n\t};\n}\n\nfunction wrapWorkerEntrypoint(\n\tklass: WorkerEntrypointConstructor\n): WorkerEntrypointConstructor {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn klass;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\t// `extend`ing `klass` here so other RPC methods remain callable\n\treturn class extends klass {\n\t\t#fetchDispatcher: ExportedHandlerFetchHandler<Record<string, unknown>> = (\n\t\t\trequest,\n\t\t\tenv,\n\t\t\tctx\n\t\t) => {\n\t\t\tthis.env = env;\n\t\t\tthis.ctx = ctx;\n\t\t\tif (super.fetch === undefined) {\n\t\t\t\tthrow new Error(\"Entrypoint class does not define a fetch() function.\");\n\t\t\t}\n\t\t\treturn super.fetch(request);\n\t\t};\n\n\t\t#dispatcher: Dispatcher = (type, init) => {\n\t\t\tif (type === \"scheduled\" && super.scheduled !== undefined) {\n\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\tDate.now(),\n\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t() => {}\n\t\t\t\t);\n\t\t\t\treturn super.scheduled(controller);\n\t\t\t}\n\t\t};\n\n\t\tfetch(request: Request<unknown, IncomingRequestCfProperties>) {\n\t\t\treturn __facade_invoke__(\n\t\t\t\trequest,\n\t\t\t\tthis.env,\n\t\t\t\tthis.ctx,\n\t\t\t\tthis.#dispatcher,\n\t\t\t\tthis.#fetchDispatcher\n\t\t\t);\n\t\t}\n\t};\n}\n\nlet WRAPPED_ENTRY: ExportedHandler | WorkerEntrypointConstructor | undefined;\nif (typeof ENTRY === \"object\") {\n\tWRAPPED_ENTRY = wrapExportedHandler(ENTRY);\n} else if (typeof ENTRY === \"function\") {\n\tWRAPPED_ENTRY = wrapWorkerEntrypoint(ENTRY);\n}\nexport default WRAPPED_ENTRY;\n"],
  "mappings": ";;;;AAAA,IAAM,OAAO,oBAAI,IAAI;AAErB,SAAS,SAAS,SAAS,MAAM;AAChC,QAAM,MACL,mBAAmB,MAChB,UACA,IAAI;AAAA,KACH,OAAO,YAAY,WACjB,IAAI,QAAQ,SAAS,IAAI,IACzB,SACD;AAAA,EACH;AACH,MAAI,IAAI,QAAQ,IAAI,SAAS,SAAS,IAAI,aAAa,UAAU;AAChE,QAAI,CAAC,KAAK,IAAI,IAAI,SAAS,CAAC,GAAG;AAC9B,WAAK,IAAI,IAAI,SAAS,CAAC;AACvB,cAAQ;AAAA,QACP;AAAA,KACO,IAAI,SAAS,CAAC;AAAA;AAAA,MACtB;AAAA,IACD;AAAA,EACD;AACD;AAnBS;AAqBT,WAAW,QAAQ,IAAI,MAAM,WAAW,OAAO;AAAA,EAC9C,MAAM,QAAQ,SAAS,UAAU;AAChC,UAAM,CAAC,SAAS,IAAI,IAAI;AACxB,aAAS,SAAS,IAAI;AACtB,WAAO,QAAQ,MAAM,QAAQ,SAAS,QAAQ;AAAA,EAC/C;AACD,CAAC;;;ACvBD,IAAM,WAAW;AAAA,EACf,KAAK,IAAI;AAAA,EACT,KAAK;AACP;AAEA,SAAS,MAAM,OAAO,UAAU;AAC9B,QAAM,OAAO,SAAS,QAAQ;AAC9B,MAAI,QAAQ,KAAM,QAAO;AACzB,SAAO,KAAK,MAAM,QAAQ,OAAO,GAAK,IAAI;AAC5C;AAJS;AAQT,SAAS,eAAe,OAAO;AAC7B,MAAI,CAAC,MAAO,QAAO;AACnB,QAAM,QAAQ,MAAM,MAAM,mBAAmB;AAC7C,SAAO,QAAQ,SAAS,MAAM,CAAC,GAAG,EAAE,IAAI;AAC1C;AAJS;AAOT,SAAS,cAAc,OAAO;AAC5B,MAAI,CAAC,MAAO,QAAO;AACnB,SAAO,MACJ,QAAQ,wBAAwB,EAAE,EAClC,QAAQ,WAAW,GAAG,EACtB,KAAK;AACV;AANS;AAST,SAAS,aAAa,MAAM;AAC1B,QAAM,QAAQ,KAAK,KAAK,EAAE,YAAY;AACtC,MAAI,MAAM;AAEV,QAAM,WAAW,MAAM,MAAM,WAAW;AACxC,MAAI,SAAU,OAAM,SAAS,SAAS,CAAC,GAAG,EAAE;AAE5C,QAAM,WAAW,MAAM,MAAM,WAAW;AACxC,QAAM,WAAW,WAAW,SAAS,SAAS,CAAC,GAAG,EAAE,IAAI;AAExD,QAAM,QAAQ,MAAM,SAAS,KAAK;AAElC,SAAO;AAAA,IACL,gBAAgB,QAAQ,QAAQ;AAAA,IAChC,WAAW;AAAA,IACX;AAAA,IACA,KAAK;AAAA,EACP;AACF;AAlBS;AAoBT,SAAS,SAAS,MAAM;AACtB,SAAO,KACJ,KAAK,EACL,MAAM,IAAI,EACV,IAAI,CAAC,MAAM,EAAE,KAAK,CAAC,EACnB,OAAO,CAAC,MAAM,EAAE,SAAS,CAAC,EAC1B,IAAI,YAAY;AACrB;AAPS;AAWT,SAAS,SAAS,SAAS,YAAY;AAErC,MAAI,CAAC,cAAc,WAAW,WAAW,GAAG;AAC1C,WAAO,EAAE,gBAAgB,IAAI,aAAa,GAAG,WAAW,gBAAgB;AAAA,EAC1E;AACA,SAAO;AAAA,IACL,gBAAgB;AAAA,IAChB,aAAa;AAAA,IACb,WAAW;AAAA,EACb;AACF;AAVS;AAaT,SAAS,MAAM,OAAO;AACpB,QAAM,SAAS;AAAA,IACb;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACF;AAEA,QAAM,OAAO,MAAM,IAAI,OAAK;AAC1B,QAAI,EAAE,WAAW,WAAW;AAC1B,aAAO;AAAA,QACL,EAAE,KAAK,OAAO;AAAA,QACd,EAAE,KAAK,OAAO;AAAA,QACd;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA,EAAE;AAAA,QACF;AAAA,MACF;AAAA,IACF;AACA,WAAO;AAAA,MACL,GAAG,EAAE,IAAI,SAAS;AAAA,MAClB,EAAE,IAAI;AAAA,MACN,EAAE;AAAA,MACF,EAAE;AAAA,MACF,EAAE,UAAU,QAAQ,QAAQ;AAAA,MAC5B,EAAE;AAAA,MACF,EAAE;AAAA,MACF,EAAE,UAAU,eAAe;AAAA,IAC7B;AAAA,EACF,CAAC;AAGD,QAAM,MAAM;AACZ,SAAO,MAAM,CAAC,QAAQ,GAAG,IAAI,EAC1B,IAAI,OAAK,EAAE,IAAI,OAAK,IAAI,OAAO,KAAK,EAAE,EAAE,QAAQ,MAAM,IAAI,CAAC,GAAG,EAAE,KAAK,GAAG,CAAC,EACzE,KAAK,MAAM;AAChB;AA1CS;AA6CT,SAAS,yBAAyB,WAAW,aAAa;AACxD,MAAI,CAAC,YAAa,QAAO;AACzB,QAAM,MAAM,oBAAI,KAAK;AACrB,QAAM,UAAU,IAAI,KAAK,WAAW;AACpC,QAAM,WAAW,MAAM,YAAY,MAAO,KAAK,KAAK;AAEpD,QAAM,cAAc,KAAK,IAAI,CAAC,UAAU,EAAE;AAC1C,SAAO,KAAK,MAAM,YAAY,cAAc,GAAG,IAAI;AACrD;AARS;AAWT,IAAO,iBAAQ;AAAA;AAAA,EAEb,MAAM,UAAU,OAAO,KAAK,KAAK;AAG/B,YAAQ,IAAI,oCAAmC,oBAAI,KAAK,GAAE,YAAY,CAAC;AAEvE;AAAA,EACF;AAAA,EAEA,MAAM,MAAM,KAAK,KAAK;AACpB,UAAM,MAAM,IAAI,IAAI,IAAI,GAAG;AAG3B,QAAI,IAAI,aAAa,kBAAkB;AACrC,YAAM,WAAW,IAAI,QAAQ,IAAI,aAAa;AAC9C,UAAI,CAAC,YAAY,aAAa,IAAI,WAAW;AAC3C,eAAO,IAAI,SAAS,gBAAgB,EAAE,QAAQ,IAAI,CAAC;AAAA,MACrD;AAEA,aAAO,SAAS,KAAK;AAAA,QACnB,QAAQ;AAAA,QACR,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,QAClC,SAAS;AAAA,MACX,CAAC;AAAA,IACH;AAGA,QAAI,IAAI,WAAW,WAAW;AAC5B,aAAO,IAAI,SAAS,MAAM;AAAA,QACxB,SAAS;AAAA,UACP,+BAA+B;AAAA,UAC/B,gCAAgC;AAAA,UAChC,gCAAgC;AAAA,QAClC;AAAA,MACF,CAAC;AAAA,IACH;AAGA,QAAI,IAAI,WAAW,OAAO;AACxB,YAAM,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA0Pb,aAAO,IAAI,SAAS,MAAM,EAAE,SAAS,EAAE,gBAAgB,aAAa,+BAA+B,IAAI,EAAE,CAAC;AAAA,IAC5G;AAEA,QAAI,IAAI,WAAW,QAAQ;AACzB,aAAO,IAAI,SAAS,aAAa,EAAE,QAAQ,IAAI,CAAC;AAAA,IAClD;AAEA,QAAI;AACJ,QAAI;AACF,aAAO,MAAM,IAAI,KAAK;AAAA,IACxB,QAAQ;AACN,aAAO,SAAS,KAAK,EAAE,QAAQ,SAAS,SAAS,eAAe,GAAG,EAAE,QAAQ,IAAI,CAAC;AAAA,IACpF;AAEA,UAAM,UAAU,KAAK;AACrB,QAAI,CAAC,WAAW,OAAO,YAAY,UAAU;AAC3C,aAAO,SAAS,KAAK,EAAE,QAAQ,SAAS,SAAS,sBAAsB,GAAG,EAAE,QAAQ,IAAI,CAAC;AAAA,IAC3F;AAGA,UAAM,WAAW,SAAS,OAAO;AAGjC,UAAM,UAAU,CAAC;AACjB,eAAW,KAAK,UAAU;AACxB,UAAI,CAAC,EAAE,kBAAkB,EAAE,aAAa,MAAM;AAC5C,gBAAQ,KAAK,EAAE,KAAK,GAAG,QAAQ,eAAe,CAAC;AAC/C;AAAA,MACF;AAGA,YAAM,EAAE,SAAS,KAAK,IAAI,MAAM,IAAI,GAAG,QAAQ;AAAA;AAAA;AAAA;AAAA;AAAA,OAK9C,EACE,KAAK,EAAE,gBAAgB,EAAE,SAAS,EAClC,IAAI;AAEP,YAAM,aAAa,KAAK,IAAI,CAAC,OAAO;AAAA,QAClC,OAAO,EAAE;AAAA,QACT,SAAS,EAAE;AAAA,QACX,WAAW,EAAE;AAAA,QACb,aAAa,EAAE;AAAA,QACf,gBAAgB,EAAE;AAAA,QAClB,QAAQ,EAAE,MAAM,EAAE,aAAa,QAAQ,EAAE,cAAc;AAAA,QACvD,aAAa,EAAE;AAAA,QACf,cAAc,EAAE;AAAA,MAClB,EAAE;AAEF,UAAI,WAAW,WAAW,GAAG;AAC3B,gBAAQ,KAAK,EAAE,KAAK,GAAG,QAAQ,YAAY,CAAC;AAC5C;AAAA,MACF;AAGA,YAAM,gBAAgB,WAAW,IAAI,CAAC,GAAG,QAAQ;AAC/C,cAAM,aAAa,EAAE,MAAM,MAAM,QAAQ;AACzC,cAAM,QAAQ,aAAa,WAAW,CAAC,IAAI;AAG3C,cAAM,UAAU,eAAe,EAAE,OAAO;AAGxC,cAAM,YAAY,cAAc,EAAE,OAAO,KAAK,EAAE,MAAM,UAAU,GAAG,EAAE;AACrE,cAAM,QAAQ,UAAU,IAAI,GAAG,OAAO,OAAO,SAAS,KAAK,OAAO,SAAS;AAC3E,cAAM,eAAe,MAAM,EAAE,aAAa,EAAE,cAAc;AAC1D,cAAM,iBAAiB,EAAE;AAGzB,cAAMA,gBAAe,gBAAgB,OAAO,KAAK,MAAO,eAAe,UAAW,GAAK,IAAI,MAAQ;AACnG,cAAM,iBAAiB,iBAAiB;AAExC,cAAM,OAAO,yBAAyB,MAAM,EAAE,YAAY;AAC1D,cAAM,OAAO,QAAQ,MAAM,QAAQ,QAAQ,MAAM,WAAW;AAE5D,eAAO;AAAA,UACL,IAAI,QAAQ,GAAG,IAAI,EAAE,SAAS;AAAA,UAC9B;AAAA;AAAA,UAEA,mBAAmB,EAAE;AAAA,UACrB,eAAe;AAAA,UACf;AAAA;AAAA,UACA,OAAO,EAAE;AAAA,UACT,SAAS,EAAE;AAAA;AAAA,UAEX,UAAU;AAAA,UACV,gBAAgB;AAAA,UAChB,kBAAkB;AAAA;AAAA,UAElB,gBAAgBA;AAAA,UAChB,kBAAkB;AAAA,UAClB,gBAAgB,EAAE;AAAA,UAClB,YAAY;AAAA,UACZ;AAAA,UACA,QAAQ,EAAE,QAAQ,QAAQ;AAAA,UAC1B,kBAAkB;AAAA,UAClB,UAAU;AAAA,UACV,aAAa,EAAE;AAAA,UACf,cAAc,EAAE;AAAA,UAChB,SAAS;AAAA,QACX;AAAA,MACF,CAAC;AAGD,oBAAc,KAAK,CAAC,GAAGC,OAAM;AAC3B,YAAIA,GAAE,eAAe,EAAE,WAAY,QAAOA,GAAE,aAAa,EAAE;AAC3D,gBAAQ,EAAE,kBAAkB,QAAQA,GAAE,kBAAkB;AAAA,MAC1D,CAAC;AAGD,UAAI,cAAc,SAAS,GAAG;AAC5B,sBAAc,CAAC,EAAE,UAAU;AAAA,MAC7B;AAGA,YAAM,OAAO,SAAS,GAAG,UAAU;AACnC,YAAM,cAAc,KAAK,kBAAkB,IAAI,KAAK,iBAAiB;AACrE,YAAM,WAAW,WAAW,WAAW;AAGvC,YAAM,eAAe,MAAM,SAAS,aAAa,SAAS,cAAc;AACxE,YAAM,gBAAgB,gBAAgB,OAAO,eAAe,EAAE,MAAM;AAGpE,YAAM,eAAe,yBAAyB,KAAK,aAAa,SAAS,YAAY;AAErF,cAAQ,KAAK;AAAA,QACX,KAAK;AAAA,QACL,QAAQ;AAAA,QACR;AAAA,QACA,gBAAgB;AAAA,QAChB,iBAAiB;AAAA,QACjB,kBAAkB,SAAS;AAAA,QAC3B,gBAAgB,SAAS;AAAA,QACzB,cAAc,SAAS,SAAS,cAAc,KAAK;AAAA,QACnD,aAAa;AAAA,QACb,WAAW,KAAK;AAAA,QAChB,WAAW,SAAS;AAAA;AAAA,QAEpB,YAAY;AAAA,MACd,CAAC;AAAA,IACH;AAGA,UAAM,SAAS,IAAI,aAAa,IAAI,QAAQ;AAE5C,QAAI,WAAW,OAAO;AACpB,YAAM,MAAM,MAAM,OAAO;AACzB,aAAO,IAAI,SAAS,KAAK;AAAA,QACvB,SAAS;AAAA,UACP,gBAAgB;AAAA,UAChB,uBAAuB;AAAA,UACvB,+BAA+B;AAAA,QACjC;AAAA,MACF,CAAC;AAAA,IACH;AAEA,WAAO,SAAS;AAAA,MACd;AAAA,QACE,QAAQ;AAAA,QACR,UAAU;AAAA,QACV,eAAc,oBAAI,KAAK,GAAE,YAAY;AAAA,QACrC,OAAO;AAAA,MACT;AAAA,MACA;AAAA,QACE,SAAS;AAAA,UACP,+BAA+B;AAAA,QACjC;AAAA,MACF;AAAA,IACF;AAAA,EACF;AACF;;;ACplBA,IAAM,YAAwB,8BAAO,SAAS,KAAK,MAAM,kBAAkB;AAC1E,MAAI;AACH,WAAO,MAAM,cAAc,KAAK,SAAS,GAAG;AAAA,EAC7C,UAAE;AACD,QAAI;AACH,UAAI,QAAQ,SAAS,QAAQ,CAAC,QAAQ,UAAU;AAC/C,cAAM,SAAS,QAAQ,KAAK,UAAU;AACtC,eAAO,EAAE,MAAM,OAAO,KAAK,GAAG,MAAM;AAAA,QAAC;AAAA,MACtC;AAAA,IACD,SAAS,GAAG;AACX,cAAQ,MAAM,4CAA4C,CAAC;AAAA,IAC5D;AAAA,EACD;AACD,GAb8B;AAe9B,IAAO,6CAAQ;;;ACRf,SAAS,YAAY,GAAmB;AACvC,SAAO;AAAA,IACN,MAAM,GAAG;AAAA,IACT,SAAS,GAAG,WAAW,OAAO,CAAC;AAAA,IAC/B,OAAO,GAAG;AAAA,IACV,OAAO,GAAG,UAAU,SAAY,SAAY,YAAY,EAAE,KAAK;AAAA,EAChE;AACD;AAPS;AAUT,IAAM,YAAwB,8BAAO,SAAS,KAAK,MAAM,kBAAkB;AAC1E,MAAI;AACH,WAAO,MAAM,cAAc,KAAK,SAAS,GAAG;AAAA,EAC7C,SAAS,GAAQ;AAChB,UAAM,QAAQ,YAAY,CAAC;AAC3B,WAAO,SAAS,KAAK,OAAO;AAAA,MAC3B,QAAQ;AAAA,MACR,SAAS,EAAE,+BAA+B,OAAO;AAAA,IAClD,CAAC;AAAA,EACF;AACD,GAV8B;AAY9B,IAAO,2CAAQ;;;ACzBJ,IAAM,mCAAmC;AAAA,EAE9B;AAAA,EAAyB;AAC3C;AACA,IAAO,sCAAQ;;;ACcnB,IAAM,wBAAsC,CAAC;AAKtC,SAAS,uBAAuB,MAAqC;AAC3E,wBAAsB,KAAK,GAAG,KAAK,KAAK,CAAC;AAC1C;AAFgB;AAShB,SAAS,uBACR,SACA,KACA,KACA,UACA,iBACsB;AACtB,QAAM,CAAC,MAAM,GAAG,IAAI,IAAI;AACxB,QAAM,gBAAmC;AAAA,IACxC;AAAA,IACA,KAAK,YAAY,QAAQ;AACxB,aAAO,uBAAuB,YAAY,QAAQ,KAAK,UAAU,IAAI;AAAA,IACtE;AAAA,EACD;AACA,SAAO,KAAK,SAAS,KAAK,KAAK,aAAa;AAC7C;AAfS;AAiBF,SAAS,kBACf,SACA,KACA,KACA,UACA,iBACsB;AACtB,SAAO,uBAAuB,SAAS,KAAK,KAAK,UAAU;AAAA,IAC1D,GAAG;AAAA,IACH;AAAA,EACD,CAAC;AACF;AAXgB;;;AC3ChB,IAAM,iCAAN,MAAM,gCAA8D;AAAA,EAGnE,YACU,eACA,MACT,SACC;AAHQ;AACA;AAGT,SAAK,WAAW;AAAA,EACjB;AAAA,EArBD,OAYoE;AAAA;AAAA;AAAA,EAC1D;AAAA,EAUT,UAAU;AACT,QAAI,EAAE,gBAAgB,kCAAiC;AACtD,YAAM,IAAI,UAAU,oBAAoB;AAAA,IACzC;AAEA,SAAK,SAAS;AAAA,EACf;AACD;AAEA,SAAS,oBAAoB,QAA0C;AAEtE,MACC,qCAAqC,UACrC,iCAAiC,WAAW,GAC3C;AACD,WAAO;AAAA,EACR;AAEA,aAAW,cAAc,kCAAkC;AAC1D,wBAAoB,UAAU;AAAA,EAC/B;AAEA,QAAM,kBAA+C,gCACpD,SACA,KACA,KACC;AACD,QAAI,OAAO,UAAU,QAAW;AAC/B,YAAM,IAAI,MAAM,6CAA6C;AAAA,IAC9D;AACA,WAAO,OAAO,MAAM,SAAS,KAAK,GAAG;AAAA,EACtC,GATqD;AAWrD,SAAO;AAAA,IACN,GAAG;AAAA,IACH,MAAM,SAAS,KAAK,KAAK;AACxB,YAAM,aAAyB,gCAAU,MAAM,MAAM;AACpD,YAAI,SAAS,eAAe,OAAO,cAAc,QAAW;AAC3D,gBAAM,aAAa,IAAI;AAAA,YACtB,KAAK,IAAI;AAAA,YACT,KAAK,QAAQ;AAAA,YACb,MAAM;AAAA,YAAC;AAAA,UACR;AACA,iBAAO,OAAO,UAAU,YAAY,KAAK,GAAG;AAAA,QAC7C;AAAA,MACD,GAT+B;AAU/B,aAAO,kBAAkB,SAAS,KAAK,KAAK,YAAY,eAAe;AAAA,IACxE;AAAA,EACD;AACD;AAxCS;AA0CT,SAAS,qBACR,OAC8B;AAE9B,MACC,qCAAqC,UACrC,iCAAiC,WAAW,GAC3C;AACD,WAAO;AAAA,EACR;AAEA,aAAW,cAAc,kCAAkC;AAC1D,wBAAoB,UAAU;AAAA,EAC/B;AAGA,SAAO,cAAc,MAAM;AAAA,IAC1B,mBAAyE,wBACxE,SACA,KACA,QACI;AACJ,WAAK,MAAM;AACX,WAAK,MAAM;AACX,UAAI,MAAM,UAAU,QAAW;AAC9B,cAAM,IAAI,MAAM,sDAAsD;AAAA,MACvE;AACA,aAAO,MAAM,MAAM,OAAO;AAAA,IAC3B,GAXyE;AAAA,IAazE,cAA0B,wBAAC,MAAM,SAAS;AACzC,UAAI,SAAS,eAAe,MAAM,cAAc,QAAW;AAC1D,cAAM,aAAa,IAAI;AAAA,UACtB,KAAK,IAAI;AAAA,UACT,KAAK,QAAQ;AAAA,UACb,MAAM;AAAA,UAAC;AAAA,QACR;AACA,eAAO,MAAM,UAAU,UAAU;AAAA,MAClC;AAAA,IACD,GAT0B;AAAA,IAW1B,MAAM,SAAwD;AAC7D,aAAO;AAAA,QACN;AAAA,QACA,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,MACN;AAAA,IACD;AAAA,EACD;AACD;AAnDS;AAqDT,IAAI;AACJ,IAAI,OAAO,wCAAU,UAAU;AAC9B,kBAAgB,oBAAoB,mCAAK;AAC1C,WAAW,OAAO,wCAAU,YAAY;AACvC,kBAAgB,qBAAqB,mCAAK;AAC3C;AACA,IAAO,kCAAQ;",
  "names": ["unitPriceUsd", "b"]
}
